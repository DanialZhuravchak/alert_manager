<form stylesheet="table_decorations.css" script="table_action.js" refresh="300">
  <label>Alert Monitoring</label>
  <fieldset autoRun="true" submitButton="true">
    <input type="time" searchWhenChanged="true">
      <label>Timerange</label>
      <default>
        <earliestTime>-24h</earliestTime>
        <latestTime>now</latestTime>
      </default>
    </input>
    <input type="dropdown" token="environment" searchWhenChanged="true">
      <label>Environment</label>
      <choice value="*">All</choice>
      <seed>*</seed>
      <default>*</default>
      <populatingSearch earliest="-1m" latest="now" fieldForLabel="environment" fieldForValue="environment">|inputlookup alerts.csv |dedup environment |table environment |sort environment</populatingSearch>
    </input>
    <input type="dropdown" token="stack" searchWhenChanged="true">
      <label>Stack</label>
      <choice value="*">All</choice>
      <seed>*</seed>
      <default>*</default>
      <populatingSearch earliest="-1m" latest="now" fieldForLabel="stack" fieldForValue="stack">|inputlookup expanded_inventory |dedup stack|table stack |sort stack</populatingSearch>
    </input>
    <input type="dropdown" token="severity" searchWhenChanged="true">
      <label>Severity</label>
      <choice value="*">All</choice>
      <seed>*</seed>
      <default>*</default>
      <populatingSearch earliest="-1m" latest="now" fieldForLabel="severity" fieldForValue="severity">|inputlookup alerts.csv |dedup severity |table severity |sort severity</populatingSearch>
    </input>
    <input type="dropdown" token="category" searchWhenChanged="true">
      <label>Category</label>
      <choice value="*">All</choice>
      <seed>*</seed>
      <default>*</default>
      <populatingSearch earliest="-1m" latest="now" fieldForLabel="category" fieldForValue="category">|inputlookup alerts.csv |dedup category |table category |sort category</populatingSearch>
    </input>
    <input type="dropdown" token="alert" searchWhenChanged="true">
      <label>Alert</label>
      <choice value="*">All</choice>
      <seed>*</seed>
      <default>*</default>
      <populatingSearch earliest="-1m" latest="now" fieldForLabel="savedsearch_name" fieldForValue="savedsearch_name">|inputlookup alerts.csv |dedup savedsearch_name |table savedsearch_name |sort savedsearch_name</populatingSearch>
    </input>
    <input type="dropdown" token="action" searchWhenChanged="true">
      <label>Action</label>
      <choice value="*">All</choice>
      <choice value="checked">checked</choice>
      <choice value="unchecked">unchecked</choice>
      <default>*</default>
    </input>
  </fieldset>
  <row>
    <table>
      <title>Recent Alerts</title>
      <searchString>index=alerts sourcetype=alert* index=alerts sourcetype=alert* | lookup expanded_inventory dvc_ip as results{}.host OUTPUT stack | stats first(entry{}.content.label) as alert first(_time) as _time values(entry{}.content.eventSearch) as search values(entry{}.content.earliestTime) as earliest values(entry{}.content.latestTime) as latest values(stack) as stack first(entry{}.acl.app) as app  by job_id | rename job_id as sid | rex mode=sed field=search "s/^search //g" | lookup local=true alerts.csv savedsearch_name AS alert OUTPUT severity, category, environment, status  |search status=enabled category=$category$ environment=$environment$ severity=$severity$ alert=$alert$ stack=$stack$| lookup local=true searches_alerts.csv sid OUTPUT action_status owner description |  rename owner AS Alert_Owner |  eval action=if(action_status!="","checked","unchecked")|search action=* | table action, Alert_Owner, description, sid, dosearch, _time, alert, app, severity, category, environment, stack, search, earliest, latest |sort -_time</searchString>
      <earliestTime>$earliest$</earliestTime>
      <latestTime>$latest$</latestTime>
      <option name="drilldown">none</option>
      <drilldown>
        <set token="drilldown_sid">$row.sid$</set>
      </drilldown>
      <option name="wrap">true</option>
      <option name="rowNumbers">false</option>
      <option name="dataOverlayMode">none</option>
      <option name="count">10</option>
    </table>
  </row>
  <row>
    <table id="alert_details" depends="$drilldown_sid$">
      <title>Alert Details</title>
      <searchTemplate>|loadjob $drilldown_sid$</searchTemplate>
      <!-- <searchTemplate>| loadjob 1404902183.1166</searchTemplate> -->
      <option name="count">20</option>
    </table>
  </row>
  <row>
    <chart>
      <title>Alerts by Severity</title>
      <searchString>index=alerts sourcetype=alert* index=alerts sourcetype=alert* | lookup expanded_inventory dvc_ip as results{}.host OUTPUT stack | stats first(entry{}.content.label) as alert first(_time) as _time values(entry{}.content.eventSearch) as search values(entry{}.content.earliestTime) as earliest values(entry{}.content.latestTime) as latest values(stack) as stack first(entry{}.acl.app) as app  by job_id | rename job_id as sid | rex mode=sed field=search "s/^search //g" | lookup local=true alerts.csv savedsearch_name AS alert OUTPUT severity, category, environment, status  |search category=$category$ environment=$environment$ severity=$severity$ alert=$alert$ stack=$stack$| lookup local=true searches_alerts.csv sid OUTPUT action_status owner description |  rename owner AS Alert_Owner |  eval action=if(action_status!="","checked","unchecked")|search action=* |timechart count by severity</searchString>
      <earliestTime>$earliest$</earliestTime>
      <latestTime>$latest$</latestTime>
      <option name="charting.axisTitleX.visibility">visible</option>
      <option name="charting.axisTitleY.visibility">visible</option>
      <option name="charting.axisX.scale">linear</option>
      <option name="charting.axisY.scale">linear</option>
      <option name="charting.chart">line</option>
      <option name="charting.chart.nullValueMode">gaps</option>
      <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
      <option name="charting.chart.stackMode">default</option>
      <option name="charting.chart.style">shiny</option>
      <option name="charting.drilldown">all</option>
      <option name="charting.layout.splitSeries">0</option>
      <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
      <option name="charting.legend.placement">right</option>
      <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
      <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
      <option name="charting.axisTitleY2.visibility">visible</option>
      <option name="charting.axisY2.enabled">false</option>
      <option name="charting.axisY2.scale">inherit</option>
    </chart>
    <chart>
      <title>Alerts by Category</title>
      <searchString>index=alerts sourcetype=alert* index=alerts sourcetype=alert* | lookup expanded_inventory dvc_ip as results{}.host OUTPUT stack | stats first(entry{}.content.label) as alert first(_time) as _time values(entry{}.content.eventSearch) as search values(entry{}.content.earliestTime) as earliest values(entry{}.content.latestTime) as latest values(stack) as stack first(entry{}.acl.app) as app  by job_id | rename job_id as sid | rex mode=sed field=search "s/^search //g" | lookup local=true alerts.csv savedsearch_name AS alert OUTPUT severity, category, environment, status  |search category=$category$ environment=$environment$ severity=$severity$ alert=$alert$ stack=$stack$| lookup local=true searches_alerts.csv sid OUTPUT action_status owner description |  rename owner AS Alert_Owner |  eval action=if(action_status!="","checked","unchecked")|search action=* |timechart count by category</searchString>
      <earliestTime>$earliest$</earliestTime>
      <latestTime>$latest$</latestTime>
      <option name="charting.axisTitleX.visibility">visible</option>
      <option name="charting.axisTitleY.visibility">visible</option>
      <option name="charting.axisX.scale">linear</option>
      <option name="charting.axisY.scale">linear</option>
      <option name="charting.chart">line</option>
      <option name="charting.chart.nullValueMode">gaps</option>
      <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
      <option name="charting.chart.stackMode">default</option>
      <option name="charting.chart.style">shiny</option>
      <option name="charting.drilldown">all</option>
      <option name="charting.layout.splitSeries">0</option>
      <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
      <option name="charting.legend.placement">right</option>
      <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
      <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
      <option name="charting.axisTitleY2.visibility">visible</option>
      <option name="charting.axisY2.enabled">false</option>
      <option name="charting.axisY2.scale">inherit</option>
    </chart>
    <chart>
      <title>Alerts by Stack</title>
      <searchString>index=alerts sourcetype=alert* index=alerts sourcetype=alert* | lookup expanded_inventory dvc_ip as results{}.host OUTPUT stack | stats first(entry{}.content.label) as alert first(_time) as _time values(entry{}.content.eventSearch) as search values(entry{}.content.earliestTime) as earliest values(entry{}.content.latestTime) as latest values(stack) as stack first(entry{}.acl.app) as app  by job_id | rename job_id as sid | rex mode=sed field=search "s/^search //g" | lookup local=true alerts.csv savedsearch_name AS alert OUTPUT severity, category, environment, status  |search status=enabled category=$category$ environment=$environment$ severity=$severity$ alert=$alert$ stack=$stack$| lookup local=true searches_alerts.csv sid OUTPUT action_status owner description |  rename owner AS Alert_Owner |  eval action=if(action_status!="","checked","unchecked")|search action=* |timechart count by stack</searchString>
      <earliestTime>$earliest$</earliestTime>
      <latestTime>$latest$</latestTime>
      <option name="charting.axisTitleX.visibility">visible</option>
      <option name="charting.axisTitleY.visibility">visible</option>
      <option name="charting.axisX.scale">linear</option>
      <option name="charting.axisY.scale">linear</option>
      <option name="charting.chart">line</option>
      <option name="charting.chart.nullValueMode">gaps</option>
      <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
      <option name="charting.chart.stackMode">default</option>
      <option name="charting.chart.style">shiny</option>
      <option name="charting.drilldown">all</option>
      <option name="charting.layout.splitSeries">0</option>
      <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
      <option name="charting.legend.placement">right</option>
      <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
      <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
      <option name="charting.axisTitleY2.visibility">visible</option>
      <option name="charting.axisY2.enabled">false</option>
      <option name="charting.axisY2.scale">inherit</option>
    </chart>
  </row>
</form>