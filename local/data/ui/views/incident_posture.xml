<form stylesheet="incident_posture.css" script="incident_posture.js">
  <label>Incident Posture</label>
  <fieldset autoRun="true" submitButton="true">
    <input type="time" searchWhenChanged="true" token="global_time">
      <label>Timerange:</label>
      <default>
        <earliest>-24h</earliest>
        <latest>now</latest>
      </default>
    </input>
  </fieldset>
  <search id="base_single_search">
    <query>| `all_alerts_single_trend("$global_time.earliest$","$global_time.latest$")` | eval is_now=1 | append [| `all_alerts_single_trend("-48h","-24h")` | eval is_trend=1 ] </query>
    <earliest>$global_time.earliest$</earliest>
    <latest>$global_time.latest$</latest>
  </search>
  <row>
    <panel>
      <single id="sv_info">
        <title>Informational</title>
        <search base="base_single_search">
          <query>search urgency="informational" | stats count(is_now) AS count, count(is_trend) AS trend_count | eval trend=count-trend_count</query>
        </search>
        <option name="drilldown">none</option>
        <option name="field">count</option>
        <option name="trendField">trend</option>
      </single>
      <single id="sv_low">
        <title>Low</title>
        <search base="base_single_search">
          <query>search urgency="low" | stats count(is_now) AS count, count(is_trend) AS trend_count | eval trend=count-trend_count</query>
        </search>
        <option name="drilldown">none</option>
        <option name="field">count</option>
        <option name="trendField">trend</option>
      </single>
      <single id="sv_medium">
        <title>Medium</title>
        <search base="base_single_search">
          <query>search urgency="medium" | stats count(is_now) AS count, count(is_trend) AS trend_count | eval trend=count-trend_count</query>
        </search>
        <option name="drilldown">none</option>
        <option name="field">count</option>
        <option name="trendField">trend</option>
      </single>
      <single id="sv_high">
        <title>High</title>
        <search base="base_single_search">
          <query>search urgency="high"| stats count(is_now) AS count, count(is_trend) AS trend_count | eval trend=count-trend_count</query>
        </search>
        <option name="drilldown">none</option>
        <option name="field">count</option>
        <option name="trendField">trend</option>
      </single>
      <single id="sv_critical">
        <title>Critical</title>
        <search base="base_single_search">
          <query>search urgency="critical"| stats count(is_now) AS count, count(is_trend) AS trend_count | eval trend=count-trend_count</query>
        </search>
        <option name="drilldown">none</option>
        <option name="field">count</option>
        <option name="trendField">trend</option>
      </single>
    </panel>
  </row>
  <row>
    <panel>
      <title>Recent Incidents</title>
      <input type="dropdown" token="owner" searchWhenChanged="true">
        <label>Owner:</label>
        <search>
          <query>|inputlookup incidents |dedup owner |table owner |sort owner</query>
          <earliest>-1m</earliest>
          <latest>now</latest>
        </search>
        <fieldForLabel>owner</fieldForLabel>
        <fieldForValue>owner</fieldForValue>
        <choice value="*">All</choice>
        <default>*</default>
      </input>
      <input type="dropdown" token="alert" searchWhenChanged="true">
        <label>Alert:</label>
        <choice value="*">All</choice>
        <seed>*</seed>
        <default>*</default>
        <search>
          <query>|inputlookup alert_settings |dedup alert |table alert |sort alert</query>
          <earliest>-1m</earliest>
          <latest>now</latest>
        </search>
        <fieldForLabel>alert</fieldForLabel>
        <fieldForValue>alert</fieldForValue>
      </input>
      <input type="dropdown" token="category" searchWhenChanged="true">
        <label>Category:</label>
        <choice value="*">All</choice>
        <seed>*</seed>
        <default>*</default>
        <search>
          <query>|inputlookup alert_settings |dedup category |table category |sort category</query>
          <earliest>-1m</earliest>
          <latest>now</latest>
        </search>
        <fieldForLabel>category</fieldForLabel>
        <fieldForValue>category</fieldForValue>
      </input>
      <input type="dropdown" token="subcategory" searchWhenChanged="true">
        <label>Subcategory:</label>
        <choice value="*">All</choice>
        <seed>*</seed>
        <default>*</default>
        <search>
          <query>|inputlookup alert_settings |dedup subcategory |table subcategory |sort subcategory</query>
          <earliest>-1m</earliest>
          <latest>now</latest>
        </search>
        <fieldForLabel>subcategory</fieldForLabel>
        <fieldForValue>subcategory</fieldForValue>
      </input>
      <input type="multiselect" token="tags" searchWhenChanged="true">
        <label>Tags:</label>
        <choice value="*">All</choice>
        <seed>*</seed>
        <default>*,[Untagged]</default>
        <search>
          <query>|inputlookup alert_settings | makemv delim=" " tags | mvexpand tags | dedup tags | table tags | sort tags</query>
          <earliest>-1m</earliest>
          <latest>now</latest>
        </search>
        <fieldForLabel>tags</fieldForLabel>
        <fieldForValue>tags</fieldForValue>
        <valueSuffix>"</valueSuffix>
        <delimiter> OR </delimiter>
        <valuePrefix>tags="</valuePrefix>
      </input>
      <input type="multiselect" token="urgency" searchWhenChanged="true">
        <label>Urgency:</label>
        <choice value="*">All</choice>
        <seed>*</seed>
        <default>*</default>
        <search>
          <query>|inputlookup alert_urgencies | dedup urgency | table urgency</query>
          <earliest>-1m</earliest>
          <latest>now</latest>
        </search>
        <fieldForLabel>urgency</fieldForLabel>
        <fieldForValue>urgency</fieldForValue>
        <valueSuffix>"</valueSuffix>
        <delimiter> OR </delimiter>
        <valuePrefix>urgency="</valuePrefix>
      </input>
      <input type="multiselect" token="status" searchWhenChanged="true">
        <label>Status:</label>
        <choice value="status=&quot;*&quot;">All</choice>
        <choice value="status!=&quot;*resolved&quot;">All open</choice>
        <choice value="status=&quot;*resolved&quot;">All resolved</choice>
        <delimiter> OR </delimiter>
        <search>
          <query>| inputlookup alert_status | eval filter_value="status=\""+status+"\""</query>
          <earliest>0</earliest>
        </search>
        <fieldForLabel>status_description</fieldForLabel>
        <fieldForValue>filter_value</fieldForValue>
        <default>"status!=""*resolved"""</default>
      </input>
      <input type="multiselect" token="priority" searchWhenChanged="true">
        <label>Priority:</label>
        <choice value="*">All</choice>
        <seed>*</seed>
        <default>*</default>
        <search>
          <query>|inputlookup alert_urgencies | dedup priority | table priority</query>
          <earliest>-1m</earliest>
          <latest>now</latest>
        </search>
        <fieldForLabel>priority</fieldForLabel>
        <fieldForValue>priority</fieldForValue>
        <valueSuffix>"</valueSuffix>
        <delimiter> OR </delimiter>
        <valuePrefix>priority="</valuePrefix>
      </input>
      <input type="multiselect" token="severity" searchWhenChanged="true">
        <label>Severity:</label>
        <choice value="*">All</choice>
        <seed>*</seed>
        <default>*</default>
        <search>
          <query>|inputlookup alert_severities</query>
          <earliest>-1m</earliest>
          <latest>now</latest>
        </search>
        <fieldForLabel>severity</fieldForLabel>
        <fieldForValue>severity</fieldForValue>
        <valueSuffix>"</valueSuffix>
        <delimiter> OR </delimiter>
        <valuePrefix>severity="</valuePrefix>
      </input>
      <table id="alert_overview">
        <search id="recent_alerts">
          <query>| `all_alerts`| search owner="$owner$" alert="$alert$" category="$category$" subcategory="$subcategory$" $tags$ $severity$ $priority$ $urgency$ $status$ |table dosearch, doedit, _time, owner, status, status_description, job_id, alert, app, category, subcategory, tags, severity, priority, urgency, search, event_search, earliest, latest, alert_time</query>
          <earliest>$global_time.earliest$</earliest>
          <latest>$global_time.latest$</latest>
        </search>
        <option name="drilldown">row</option>
        <drilldown>
          <set token="run_inpage_drilldown">$row.job_id$</set>
        </drilldown>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="count">10</option>
        <option name="refresh.auto.interval">300</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <table id="alert_details" depends="$drilldown_job_id$">
        <title>Alert Results</title>
        <search>
          <query>|loadjob $drilldown_job_id$</query>
          <earliest>$global_time.earliest$</earliest>
          <latest>$global_time.latest$</latest>
        </search>
        <option name="count">20</option>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
      </table>
    </panel>
  </row>
</form>